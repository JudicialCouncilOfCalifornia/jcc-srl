{#
/**
 * @file
 * Template for "Find the Right Court" view.
 *
 * This View returns a single result, based on `field_parent` set in the entity
 * currently being Viewed. Typically, the level of information we're getting at
 * here would be a few levels deep, e.g. views_view_fields. However, the Pattern
 * Lab component requires all data te be passed in one place, so we are using
 * the Node entity from the views result to get data we need.
 */
#}

{% extends 'views-view.html.twig' %}

{% block header %}
  {% include '@molecules/blocks/hero/hero.twig' with {
    hero: {
      background_variant: 'has-background-color--light--secondary',
      column_variant: 'has-one-column',
      title: drupal_title(),
      lead: header,
      column_content_right: exposed,
    }
  } %}
{% endblock %}

{% block exposed %}
  {# "Unset" this block #}
{% endblock %}


{% block content %}
  <pre>
    {# {{ dump(_context|keys) }} #}
  </pre>
  {% for row in rows %}
    {% set entity = row['#rows'].0['#view'].result.0._entity %}

    {# address needs to be rendered at the same time the nl2br filter is used
       or the <br> will be escaped #}
    {% set address %}
      {{ entity.field_address.value|nl2br }}
    {% endset %}

    {% set tags = [] %}
    {% for tag in entity.field_matters_served.value|split(',') %}
      {% set tags = tags|merge([{
        text: tag|trim
      }]) %}
    {% endfor %}

    {# Building hours #}
    {% if entity.field_building_hours_summary.value %}
      {% set building_hours = entity.field_building_hours_summary.value %}
    {% else %}
      {% set building_hours = [
        entity.field_building_hours_monday.value,
        entity.field_building_hours_tuesday.value,
        entity.field_building_hours_wednesday.value,
        entity.field_building_hours_thursday.value,
        entity.field_building_hours_friday.value,
      ]|trim_empty|join('<br>') %}
    {% endif %}

    {# Filing hours #}
    {% if entity.field_filing_hours_summary.value %}
      {% set filing_hours = entity.field_filing_hours_summary.value %}
    {% else %}
      {% set filing_hours = [
        entity.field_filing_hours_monday.value,
        entity.field_filing_hours_tuesday.value,
        entity.field_filing_hours_wednesday.value,
        entity.field_filing_hours_thursday.value,
        entity.field_filing_hours_friday.value,
      ]|trim_empty|join('<br>') %}
    {% endif %}

    {# Self help hours #}
    {% set selfhelp_hours %}

      {% if entity.field_selfhelp_hours_summary.value %}
        {{ entity.field_selfhelp_hours_summary.value }}
      {% else %}
        {{ [
          entity.field_selfhelp_hours_monday.value,
          entity.field_selfhelp_hours_tuesday.value,
          entity.field_selfhelp_hours_wednesday.value,
          entity.field_selfhelp_hours_thursday.value,
          entity.field_selfhelp_hours_friday.value,
        ]|trim_empty|join('<br>') }}
      {% endif %}
    {% endset %}

    {% set location = {
      brow: entity.field_court.0.entity.title.value ~ ' County'|t,
      title: entity.title.value,
      address: address,
      phone: {
        title: entity.field_phone.0.value,
        url: 'tel:' ~ entity.field_phone.0.value|replace({'(': '', ')': '', ' ': '-'})|url_encode,
      },
      website: {
        title: entity.title.value ~ ' ' ~ 'Website'|t|render,
        url: entity.field_link.0.url|render,
      },
      tags_label: 'Matters Served',
      tags: tags,
      hours_label: 'Hours'|t|render,
      directions_title: 'Get Directions'|t|render,
      hours: [
        {
          label: 'Building'|t,
          details: building_hours,
        },
        {
          label: 'Clerks'|t,
          details: filing_hours,
        },
        {
          label: 'Self Help'|t,
          details: selfhelp_hours,
        },
      ],    } %}
    {# <pre>
      {{ dump(location) }}
    </pre> #}
    {% include '@molecules/blocks/location/location.twig' with {
      location: location
    } %}
  {% endfor %}

  {#



   #}

{% endblock %}
