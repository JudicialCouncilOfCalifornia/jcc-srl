{#
/**
 * @file
 * Template for "Timeline" Paragraph.
 */
#}
{% extends 'paragraph.html.twig' %}
{% block paragraph %}

  {% set item_content = [] %}
  {% set items = paragraph.field_timeline_dual_items %}

  {% for key, item in items.value %}
    {% set read_more = [] %}
      {% set timeline_dual_item = items.get(key).entity %}

      {# Prepare "Read more" toggle #}
      {% set read_more = {
        type: 'modal',
        modal: {
          id: 'read-more-' ~ item.id(),
          button_label: timeline_item.field_details_link_text.value|default('Read more'|t),
          content: timeline_item.field_details|view,
        }
      } %}

      {# Store each item in an array for the Pattern component. #}
      {% set item_content = item_content|merge([{
        icon: "both",
        top: {
          excerpt: timeline_dual_item.field_top_excerpt|view,
          number: timeline_dual_item.field_top_number|view,
          deadline: timeline_dual_item.field_top_deadline|view,
          read_more: read_more
        },
        bottom: {
          excerpt: timeline_dual_item.field_bottom_excerpt|view,
          number: timeline_dual_item.field_bottom_number|view,
          deadline: timeline_dual_item.field_bottom_deadline|view,
          read_more: read_more
        }
      }]) %}

  {% endfor %}

  {% include '@organisms/sections/timeline-dual/timeline-dual.twig' with {
    timeline_dual: {
      id: paragraph_id,
      top_title: paragraph.field_top_title.value,
      bottom_title: paragraph.field_bottom_title.value,
      title_bar: {
        title: paragraph.field_title_bar_title.value,
        previous: {
          url: content.field_title_bar_previous.0['#url_title'],
          title: paragraph.field_title_bar_previous.title
        },
        next: {
          url: content.field_title_bar_next.0['#url_title'],
          title: paragraph.field_title_bar_next.title
        }
      },
      items: item_content,
    }
  } only %}

  {{ content|without(
    'field_bottom_title',
    'field_timeline_dual_items',
    'field_title_bar_next',
    'field_title_bar_previous',
    'field_title_bar_title',
    'field_top_title'
  ) }}
{% endblock %}
