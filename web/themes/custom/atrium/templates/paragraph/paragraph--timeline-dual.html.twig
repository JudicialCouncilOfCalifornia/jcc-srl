{#
/**
 * @file
 * Template for "Timeline" Paragraph.
 */
#}
{% extends 'paragraph.html.twig' %}
{% block paragraph %}

  {% set item_content = [] %}
  {% set items = paragraph.field_timeline_dual_items %}

  {% for key, item in items.value %}

    {% set timeline_dual_item = items.get(key).entity %}

    {# Prepare Top Read More link/toggletoggle #}
    {% set top_read_more = {
      type: timeline_dual_item.field_top_read_more_type|view,
      link: {
        label: timeline_dual_item.field_top_read_more_link.title,
        url: timeline_dual_item.field_top_read_more_link.0['#url_title']
      },
      modal: timeline_dual_item.field_top_read_more_modal
    } %}

    {# Store each item in an array for the Pattern component. #}
    {% set item_content = item_content|merge([{
      icon: "both",
      top: {
        excerpt: timeline_dual_item.field_top_excerpt.value,
        number: timeline_dual_item.field_top_number.value,
        deadline: timeline_dual_item.field_top_deadline.value,
        read_more: top_read_more
      },
      bottom: {
        excerpt: timeline_dual_item.field_bottom_excerpt|view,
        number: timeline_dual_item.field_bottom_number.value,
        deadline: timeline_dual_item.field_bottom_deadline.value,
        read_more: bottom_read_more
      }
    }]) %}

  {% endfor %}

  {% include '@organisms/sections/timeline-dual/timeline-dual.twig' with {
    timeline_dual: {
      id: paragraph_id,
      top_title: paragraph.field_top_title.value,
      bottom_title: paragraph.field_bottom_title.value,
      title_bar: {
        title: paragraph.field_title_bar_title.value,
        previous: {
          url: content.field_title_bar_previous.0['#url_title'],
          title: paragraph.field_title_bar_previous.title
        },
        next: {
          url: content.field_title_bar_next.0['#url_title'],
          title: paragraph.field_title_bar_next.title
        }
      },
      items: item_content,
    }
  } only %}

  {{ content|without(
    'field_bottom_title',
    'field_timeline_dual_items',
    'field_title_bar_next',
    'field_title_bar_previous',
    'field_title_bar_title',
    'field_top_title'
  ) }}
{% endblock %}
