<?php

/**
 * @file
 * Contains jcc_forms.module.
 */

use Drupal\views\ViewExecutable;
use \Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_views_pre_render().
 */
function jcc_forms_views_pre_render(ViewExecutable $view) {
  if ($view->id() == 'media_jcc_forms') {
    $mids = [];

    foreach ($view->result as $i => $result) {
      $mid = $result->mid;
      if (in_array($mid, $mids)) {
        unset($view->result[$i]);
      }
      else {
        $mids[] = $mid;
      }
    }
    $view->total_rows = count($view->result);
    $view->pager->total_items = count($view->result);

    // @todo Render correct number of items per page.

  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * Alters JCC Form Edit page.
 */
function jcc_forms_form_media_jcc_form_edit_form_alter(&$form, FormStateInterface $form_state, $form_id) {

  // Redirect to JCC Forms view on save.
  $form_state->setRedirect('view.media_jcc_forms.page_1');
}
